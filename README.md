# LCM to ROS

This package is to subscribe to and republish [Lightweight Communications and Marshalling (LCM)](https://lcm-proj.github.io/) messages into [ROS](http://wiki.ros.org/) messages. LCM is an open-source messaging tool for high-bandwidth, low-latency communications based on UDP multicast.

The goal is to make a relatively generic system that requires only LCM message files and automatically generate republishers that subscribe to an LCM topic and republish the same messages onto a ROS topic.

This package automatically generates ROS message files, CPP files, a launch file and corresponding CMakeLists for catkin_make to create a set of republishers.

The user should only need to create the lcm message files.

Note that this code is currently restricted to a limited number of data types. The LCM primive list is available [here](https://lcm-proj.github.io/type_specification.html#type_specification_primitives). We have tested:

| LCM Primitive | Scalar | Fixed length array | Variable length array |
| --- | --- | --- | --- |
| int8_t | Tested working | Tested working | Not tested |
| int16_t | Tested working | Tested working | Not tested |
| int32_t | Tested working | Tested working | Not tested |
| int64_t | Tested working | Tested working | Not tested |
| float | Tested working | Tested working | Not tested |
| double | Tested working | Tested working | Not tested |
| string | Limited testing | n/a | n/a |
| boolean | Tested working | Tested working | Not tested |
| byte | Not tested | Not tested | Not tested |

Most of the standard types work fine because they can be directly converted into ROS types. It is important to note that the code uses memcpy to directly copy data from the incoming LCM message to the ROS message. This means that you should NOT directly edit hte autogenerated msg file, because changing the order of items in the msg with respect to the LCM will mess things up. I'm also not 100% confident in the strings due to the pointers, but they seem to work. The supplied example code shows an example of all the tested types listed above.


## Installation:

(Dependency) Install LCM:
```
git clone https://github.com/lcm-proj/lcm lcm
cd lcm
./bootstrap.sh
./configure
make
sudo make install
```

Clone this repository (assuming default catkin_make workspace):
```
cd ~/catkin_ws/src
git clone git@github.com:nrjl/lcm_to_ros.git
```

Add lcm messages to the 'lcm' folder. Note that the filenames are important; the autogenerated code assumes that the name of the lcm topic is the filename for that message type. So for a file called FNAME.lcm in the lcm subdirectory, the system will subscirbe to the lcm topic FNAME, which it assumes is using message type specified in FNAME.lcm, and messages will be republished onto the ROS topic `/FNAME`. Also note that the repo ignores files (except the example) in the lcm directory, so that your message types will not be committed to the repo.

Run the bash script and then make using catkin_make:
```
cd lcm_to_ros
chmod +x lcm_to_ros_generate.sh
./lcm_to_ros_generate.sh
cd ~/catkin_ws
catkin_make
```

This will parse the lcm subdirectory for .lcm files, and for each one attempt to:
    - create the lcm C++ header in the exlcm subdirectory (using `lcm-gen`)
    - create a corresponding ROS message (in the msg subdirectory)
    - create C++ republisher code (in the autosrc subdirectory)
    - add an entry to autosrc/CMakeLists.txt
    - add an entry to launch file launch/all_republishers.launch
    
Once complete, the publishers can be run with:
`roslaunch lcm_to_ros all_republishers.launch`
Note that this launch file places all republishers under the namespace `lcm_to_ros`.

## Test example
This repo contains a test example. If you haven't added any other LCM messages (or even if you have) you should be able to confirm the code is working by performing the compilation steps, then:
In a new terminal:
`roscore`
In another terminal:
`rosrun lcm_to_ros example_t_republisher`
In a third terminal, check that the topic `/example_t` exists using:
`rostopic list`
Then, show messages using:
`rostopic echo /example_t`
Finally, in a fourth terminal:
`rosrun lcm_to_ros example_t_send_lcm`
Confirm that a message appears in the `rostopic echo` terminal.


